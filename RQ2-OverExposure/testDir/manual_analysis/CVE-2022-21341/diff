

--- a/jdk/src/share/classes/java/io/ObjectInputStream.java	Fri Nov 26 14:57:43 2021 +0300
+++ b/jdk/src/share/classes/java/io/ObjectInputStream.java	Fri Nov 26 15:04:05 2021 +0300
@@ -2449,6 +2449,13 @@
             throw new InternalError();
         }
         clear();
+        // Check that an object follows the TC_EXCEPTION typecode
+        byte tc = bin.peekByte();
+        if (tc != TC_OBJECT &&
+            tc != TC_REFERENCE) {
+            throw new StreamCorruptedException(
+                    String.format("invalid type code: %02X", tc));
+        }
         return (IOException) readObject0(Object.class, false);
     }
 

